# BOB Studio ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## âš ï¸ ç”Ÿäº§ç¯å¢ƒç™»å½•å¤±è´¥é—®é¢˜æ’æŸ¥

å¦‚æœæ‚¨çš„åº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒåå‡ºç°"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•"çš„é”™è¯¯ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ã€‚

## é—®é¢˜åŸå› 

æ‚¨çš„åº”ç”¨é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š
- **å‰ç«¯**ï¼šReact åº”ç”¨ï¼ˆæ‰“åŒ…åœ¨ `build/` ç›®å½•ï¼‰
- **åç«¯**ï¼šNode.js/Express æœåŠ¡å™¨ï¼ˆ`server.js`ï¼‰

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‰åç«¯åº”è¯¥åœ¨**åŒä¸€ä¸ªåŸŸåå’Œç«¯å£**ä¸‹è¿è¡Œã€‚

## æ¨èçš„éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ server.js ç›´æ¥æœåŠ¡ï¼ˆæœ€ç®€å•ï¼‰

`server.js` å·²ç»é…ç½®å¥½äº†æœåŠ¡é™æ€æ–‡ä»¶ï¼Œæ‚¨åªéœ€è¦ï¼š

```bash
# 1. æ„å»ºå‰ç«¯
npm run build

# 2. å¯åŠ¨æœåŠ¡å™¨ï¼ˆä¼šåŒæ—¶æœåŠ¡å‰ç«¯é™æ€æ–‡ä»¶å’Œåç«¯ APIï¼‰
npm run server
```

æœåŠ¡å™¨ä¼šè‡ªåŠ¨ï¼š
- æœåŠ¡ `build/` ç›®å½•ä¸­çš„å‰ç«¯é™æ€æ–‡ä»¶
- å¤„ç†æ‰€æœ‰ `/api/*` çš„ API è¯·æ±‚
- æ‰€æœ‰å…¶ä»–è·¯ç”±è¿”å› React åº”ç”¨çš„ `index.html`

**è®¿é—®åœ°å€**ï¼š`http://your-domain:8080`

### æ–¹å¼äºŒï¼šä½¿ç”¨ Nginx åå‘ä»£ç†

å¦‚æœæ‚¨æƒ³ä½¿ç”¨ Nginxï¼Œé…ç½®ç¤ºä¾‹ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # æœåŠ¡é™æ€æ–‡ä»¶
    location / {
        root /path/to/nano-banana-studio/build;
        try_files $uri $uri/ /index.html;
    }

    # ä»£ç† API è¯·æ±‚åˆ° Node.js æœåŠ¡å™¨
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

åŒæ—¶å¯åŠ¨ Node.js æœåŠ¡å™¨ï¼š

```bash
# æ„å»ºå‰ç«¯
npm run build

# å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼ˆä»…å¤„ç† API è¯·æ±‚ï¼‰
npm run server
```

## ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå‚è€ƒ `env.example`ï¼‰ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp env.example .env
```

ç”Ÿäº§ç¯å¢ƒå…³é”®é…ç½®ï¼š

```env
NODE_ENV=production
PORT=8080
SESSION_SECRET=your-strong-random-secret-here
API_KEY_ENCRYPTION_SECRET=your-strong-random-secret-here

# å¦‚æœä½¿ç”¨ HTTPS
USE_HTTPS=true
```

## ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹

æ¨èä½¿ç”¨ PM2 æ¥ç®¡ç† Node.js æœåŠ¡å™¨ï¼š

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start server.js --name "bob-studio"

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs bob-studio

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

## éªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ**ï¼š
   ```bash
   curl http://localhost:8080/api/health
   ```
   åº”è¯¥è¿”å›ï¼š
   ```json
   {"status":"OK","message":"Server is running",...}
   ```

2. **æ£€æŸ¥å‰ç«¯æ˜¯å¦å¯è®¿é—®**ï¼š
   åœ¨æµè§ˆå™¨è®¿é—® `http://your-domain:8080`ï¼Œåº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢ã€‚

3. **å°è¯•ç™»å½•**ï¼š
   æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ Console æ ‡ç­¾ï¼š
   - åº”è¯¥çœ‹åˆ° `ğŸ”— å°è¯•ç™»å½•ï¼ŒAPI åœ°å€: /api/auth/login?...`
   - åº”è¯¥çœ‹åˆ° `ğŸ“¡ ç™»å½•å“åº”çŠ¶æ€: 200`ï¼ˆæˆåŠŸï¼‰
   - å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œæ§åˆ¶å°ä¼šæœ‰æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## å¸¸è§é—®é¢˜

### 1. "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"

**ç—‡çŠ¶**ï¼šæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ° "Failed to fetch" é”™è¯¯

**åŸå› **ï¼šåç«¯æœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨

**è§£å†³**ï¼š
```bash
npm run server
```

### 2. "404 Not Found"

**ç—‡çŠ¶**ï¼šè®¿é—® `/api/*` è¿”å› 404

**åŸå› **ï¼šå‰ç«¯å’Œåç«¯ä¸åœ¨åŒä¸€ä¸ªåŸŸåä¸‹

**è§£å†³**ï¼š
- ç¡®ä¿å‰åç«¯éƒ¨ç½²åœ¨åŒä¸€åŸŸåç«¯å£
- æˆ–è€…ä½¿ç”¨ Nginx åå‘ä»£ç†

### 3. CORS é”™è¯¯

**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤ºè·¨åŸŸé”™è¯¯

**åŸå› **ï¼šæœåŠ¡å™¨ CORS é…ç½®é—®é¢˜

**æ£€æŸ¥**ï¼šæŸ¥çœ‹ `server.js` ç¬¬ 84-89 è¡Œçš„ CORS é…ç½®
```javascript
app.use(
  cors({
    origin: process.env.NODE_ENV === "development" ? "http://localhost:3005" : true,
    credentials: true,
  }),
);
```

### 4. Session ä¸å·¥ä½œ

**ç—‡çŠ¶**ï¼šç™»å½•ååˆ·æ–°é¡µé¢åˆé€€å‡ºç™»å½•

**åŸå› **ï¼šCookies é…ç½®é—®é¢˜

**æ£€æŸ¥**ï¼š
- ç¡®ä¿ `server.js` ä¸­çš„ `credentials: 'include'` é…ç½®æ­£ç¡®
- å¦‚æœä½¿ç”¨ HTTPSï¼Œç¡®ä¿ `USE_HTTPS=true`

## æ›´æ–°åçš„é”™è¯¯æç¤º

ç°åœ¨ç™»å½•å¤±è´¥ä¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

1. **æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨**ï¼šä¼šæç¤º "è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆè¿è¡Œ npm run serverï¼‰"
2. **å…¶ä»–ç½‘ç»œé”™è¯¯**ï¼šä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯æ¶ˆæ¯

è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–æ›´è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯ã€‚

## éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
2. æœåŠ¡å™¨æ—¥å¿—ï¼ˆè¿è¡Œ `npm run server` çš„ç»ˆç«¯è¾“å‡ºï¼‰
3. æ‚¨çš„éƒ¨ç½²æ–¹å¼ï¼ˆç›´æ¥ä½¿ç”¨ server.js è¿˜æ˜¯ä½¿ç”¨ Nginxï¼‰
4. è®¿é—®çš„ URL

