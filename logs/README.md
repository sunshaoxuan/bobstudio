# 日志文件说明

## 📝 日志系统

BOB Studio 使用按日归档的日志系统，自动管理日志文件。

### 📂 日志文件结构

```
logs/
├── README.md (本文件)
├── output.log (当前日志，实时写入)
├── output-2025-11-06.log (2025年11月6日的归档日志)
├── output-2025-11-05.log (2025年11月5日的归档日志)
└── ...
```

### 🔄 自动归档机制

#### **归档时机**

1. **日期变更时**
   - 每小时检查一次日期
   - 检测到跨日后自动归档
   - 旧日志移动到 `output-YYYY-MM-DD.log`

2. **服务器重启时**
   - 检查现有 `output.log` 的日期
   - 如果不是今天，自动归档
   - 创建新的 `output.log`

#### **跨日处理**

**场景1：正常运行中跨日**
```
时间：2025-11-06 23:59
文件：output.log（包含11月6日的日志）

↓ 1小时后（00:59）

时间：2025-11-07 00:59
系统检测到日期变更
  ↓
归档：output.log → output-2025-11-06.log
  ↓
创建：新的 output.log（11月7日）
```

**场景2：跨多日未重启**
```
output.log 内容：
[2025-11-04 10:00] 日志1
[2025-11-04 15:30] 日志2
[2025-11-05 09:20] 日志3  ← 跨日了！
[2025-11-05 18:45] 日志4
[2025-11-06 08:00] 日志5  ← 又跨日！

重启时系统检测：
- 读取第一行：2025-11-04
- 当前日期：2025-11-06
- 不一致！

处理：
1. 整个文件归档为 output-2025-11-04.log
2. 创建新的 output.log（2025-11-06）
```

#### **追加模式**

如果归档文件已存在（同一天多次重启）：
```
output-2025-11-06.log（已存在）
  +
output.log（当前文件，也是11月6日）
  ↓
追加到 output-2025-11-06.log
```

### 🕐 检查频率

- **间隔**：每小时检查一次
- **精度**：小时级别
- **影响**：日志可能延迟最多1小时归档

### 📊 日志内容

每条日志包含：
- 时间戳（精确到毫秒）
- 日志级别（log/error/warn）
- 日志内容

**示例：**
```
[2025-11-06 10:30:45.123] 🌐 开始代理 Google Gemini API | 用户: admin
[2025-11-06 10:30:45.678] ✅ API代理成功 | 耗时: 0.55s
[2025-11-06 10:31:20.456] ❌ 错误: API密钥无效
```

### 🗂️ 日志保留策略

**建议：**
- 保留最近 **30天** 的日志
- 定期清理旧日志释放空间

**手动清理脚本：**
```bash
# 删除30天前的日志
find ./logs -name "output-*.log" -mtime +30 -delete

# 或者移动到长期归档
mkdir -p ./logs/archive
find ./logs -name "output-*.log" -mtime +30 -exec mv {} ./logs/archive/ \;
```

### 🔍 日志查看

**查看当前日志：**
```bash
tail -f logs/output.log
```

**查看指定日期：**
```bash
cat logs/output-2025-11-06.log
```

**搜索错误：**
```bash
grep "❌" logs/output-2025-11-06.log
grep "ERROR" logs/output-*.log
```

### ⚠️ 注意事项

1. **不要手动删除 `output.log`**
   - 这是当前活跃的日志文件
   - 系统会自动管理

2. **归档文件可以安全删除**
   - `output-YYYY-MM-DD.log` 可以根据需要删除
   - 不影响当前运行

3. **磁盘空间监控**
   - 定期检查 `logs/` 目录大小
   - 及时清理旧日志

---

**创建时间**: 2025-11-06  
**最后更新**: 2025-11-06

